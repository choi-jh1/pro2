<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<center><h1>ì œë³´ ê¸€ ëª©ë¡</h1></center>
<div th:if="${reportCount==0}">
	<table width="500" cellspacing="0" cellpadding="0" border="1" align="center">
		<tr align="center">
			<a th:href="@{/report/write}">ì œë³´í•˜ê¸°</a>
			<td><h3>ì œë³´ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</h3></td>
		</tr>
	</table>
</div>
<div th:unless="${reportCount==0}">
	<center><a th:href="@{/report/write}">ì œë³´í•˜ê¸°</a></center>
	<table width="500" cellspacing="0" cellpadding="0" border="1" align="center">
		<tr height="30">
			<th>ì œë³´ ê¸€ ë²ˆí˜¸</th>
			<th>ì œë³´ ê¸€ ì œëª©</th>
			<th>ì‘ì„±ì¼</th>
		</tr>
		<tr th:each="report:${list}">
			<td th:text="${report.report_id}"></td>
			<td>
				<span th:if="${session.sid == report.writer_id or session.role == 'admin' or session.sid == report.assigned}">
				<a th:href="@{|/report/content?pageNum=${pageNum}&report_id=${report.report_id}|}"><span th:text="${report.title}"></span></a>
				</span>
				<span th:unless="${session.sid == report.writer_id or session.role == 'admin' or session.sid == report.assigned}">
					<a href="#" class="pw-check-link" th:data-report-id="${report.report_id}">ğŸ”’ ë¹„ë°€ê¸€ì…ë‹ˆë‹¤.</a>
				</span>
			</td>
			<td th:text="${#temporals.format(report.reg, 'yy-MM-dd HH:mm')}"></td>
		</tr>
	</table>
</div>
<div align="center" th:if="${reportCount > 0}">
	<span th:if="${startPage>10}">
		<a th:href="@{|/report/list?pageNum=${startPage-10}|}">[ì´ì „]</a>
	</span>
	<span th:if="${endPage < pageCount}">
		<a th:href="@{|/report/list?pageNum=${startPage+10}|}">[ë‹¤ìŒ]</a>
	</span>
	<span th:each="i : ${#numbers.sequence(startPage,endPage)}">
		<a th:href="@{|/report/list?pageNum=${i}|}" th:text="'['+${i}+']'"></a>
	</span>
</div>
<!-- ëª¨ë‹¬ ì°½ -->
<div id="pwModal" style="display:none;">
  <div>
    <p>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</p>
    <input type="password" id="inputPw" />
    <input type="hidden" id="hiddenReportId" />
    <button id="pwSubmitBtn">í™•ì¸</button>
    <button class="close-modal">ì·¨ì†Œ</button>
  </div>
</div>

<!-- ëª¨ë‹¬ êµ¬í˜„ -->
<script>
	$(document).ready(function(){
		// ë§í¬ í´ë¦­ì‹œ ëª¨ë‹¬
		$(".pw-check-link").click(function(e){
			e.preventDefault(); // ì´ê±° ì—†ìœ¼ë©´ aë§í¬ ê¸°ë³¸ì´ë™ë¨
			const reportID = $(this).data("report-id");
			$("#hiddenReportId").val(reportID);
			$("#inputPw").val("");
			$("#pwModal").show();
		});
		
		// ëª¨ë‹¬ ë‹«ê¸°
		$(".close-modal").click(function(){
			$("#pwModal").hide();
		});
		
		// í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ
		  $("#pwSubmitBtn").click(function () {
		    const reportId = $("#hiddenReportId").val();
		    const password = $("#inputPw").val();

		    $.ajax({
		      url: "/report/checkPw",
		      type: "POST",
		      data: { report_id: reportId, password: password },
		      success: function (result) {
		        if (result === "success") {
		          location.href = "/report/content?report_id=" + reportId;
		        } else {
		          alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤");
		        }
		      },
		      error: function () {
		        alert("ì„œë²„ ì˜¤ë¥˜");
		      }
		    });
		  });
		});
	
</script>