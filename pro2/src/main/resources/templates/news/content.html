<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${news.title}">뉴스 상세</title>
</head>

<body>
	
	<!-- 기사 제목 -->
	<h1 th:text="${news.title}">기사 제목</h1>
	
	<!-- 작성일 -->
	<p>
		작성일 : <span th:text="${#temporals.format(news.reg, 'yyyy-MM-dd HH:mm')}"></span><br>
	</p>
	
	<!-- 기자 정보 -->
	<div>
		<img th:src="${news.profile_img}" alt="기자 사진" width="60" height="60">
		<p th:text="${news.writerName}">기자 이름 나옴</p>
	</div>
	
	<!-- 기사 본문 -->
	<div>
		<p th:utext="${news.content}">기사 본문 나옴</p>
	</div>
	
	<!-- 추천 -->
	<div>
		<form th:action="@{/news/hot}" method="post">
			<input type="hidden" name="num" th:value="${news.num}">
			<button type="submit">추천</button>
			<span>추천 수 : <span th:text="${news.hot}">0</span></span>
		</form>
	</div>
	
	<!-- 댓글 -->
	<div>
		<h3>댓글</h3>
		<form th:action="@{/comment/add}" method="post">
			<input type="hidden" name="num" th:value="${news.num}">
			<textarea name="content" rows="4" cols="60" placeholder="댓글을 입력하세요."></textarea><br>
			<button type="submit">댓글 등록</button>
		</form>
	</div>
	
	<!-- 댓글 목록 -->
	<p th:text="${#lists.size(commentList)}">댓글 수</p>
	<ul>
	  <li th:each="comment : ${commentList}">
	    <div>
	      <strong th:text="${comment.writer}">작성자</strong> :
	      <span th:text="${comment.content}">댓글 내용</span><br>
	      <span th:text="${#temporals.format(comment.reg, 'yyyy-MM-dd HH:mm')}">작성 시간</span>

	      <!-- 삭제 버튼 -->
		  <!-- 답글쓰기 버튼 -->
		  <button type="button" 
		          data-com-num="${comment.com_num}" 
		          onclick="toggleReplyForm(this.getAttribute('data-com-num'))">
		    답글쓰기
		  </button>

		  <!-- 답글 폼 -->
		  <div id="replyForm${comment.com_num}" style="display:none; margin-top:10px;">
			<form onsubmit="return submitReply(event, this)">
			  <input type="hidden" name="num" th:value="${news.num}" />
			  <input type="hidden" name="com_num" th:value="${comment.com_num}" />
			  <input type="hidden" name="ref" th:value="${comment.ref}" />
			  <input type="hidden" name="re_level" th:value="${comment.re_level}" />
			  <input type="hidden" name="re_step" th:value="${comment.re_step}" />
			  <textarea name="content" rows="3" cols="50" placeholder="답글을 입력하세요." required></textarea><br />
			  <button type="submit">답글 등록</button>
			  <button type="button" onclick="toggleReplyForm(this.closest('div').id.replace('replyForm', ''))">취소</button>
			</form>
		  </div>
	    </div>
	  </li>
	</ul>

	<script>
		// 답글 폼 토글 함수
		function toggleReplyForm(comNum){
			const formDiv = document.getElementById('replyForm'+comNum);
			if(formDiv.style.display === 'none' || formDiv.style.display === ''){
				formDiv.style.display = 'block';
			}else{
				formDiv.style.display = 'none';
			}
		}
		
		// ajax로 답글 제출
		function submitReply(event, form){
			event.preventDefault();
			
			const formDate = new FormData(form);
			
			fetch('/comment/reply',{
				method: 'POST', body: formData,
			}).then(res =>{
				if(res.ok){
					location.reload();
				}else{
					alert('답글 등록 실패');
				}
			}).catch(err => {
				alerter('오류가 발생했습니다.');
				console.error(err);
			});
			
			return false;
		}
	</script>
</body>


















