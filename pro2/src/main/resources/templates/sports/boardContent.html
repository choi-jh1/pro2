<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" th:href="@{/css/main.css}">
<link rel="stylesheet" th:href="@{/css/reaction.css}">
<style>
	/* ì „ì²´ ì»¨í…Œì´ë„ˆ */
	.container_body {
		display: flex;
		flex-direction: row;
		max-width: 1100px;
		margin: 40px auto;
		gap: 30px;
		font-family: 'Noto Sans KR', sans-serif;
	}

	/* ë©”ì¸ ê¸°ì‚¬ ë°•ìŠ¤ */
	.main-content {
		flex: 1;
		background-color: #fff;
		padding: 25px;
		border: 1px solid #ddd;
		border-radius: 10px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
	}

	/* ì‚¬ì´ë“œë°” ë°•ìŠ¤ */
	.sidebar {
		width: 250px;
		background-color: #f9f9f9;
		border: 1px solid #ddd;
		border-radius: 10px;
		height: 600px;
		padding: 15px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
	}
	.sidebar a {
	  display: block;           /* ì¤„ë°”ê¿ˆ ì²˜ë¦¬ */
	  margin: 8px 0;            /* ìœ„ì•„ë˜ 8px ê°„ê²© */
	  text-decoration: none;    /* ë°‘ì¤„ ì œê±° (ì„ íƒ) */
	  color: #333;              /* ë§í¬ ìƒ‰ìƒ (ì„ íƒ) */
	}
	.ellipsis {
	  display: block;
	  width: 100%;             /* ë˜ëŠ” ì›í•˜ëŠ” í”½ì…€ ì˜ˆ: 200px */
	  overflow: hidden;
	  white-space: nowrap;
	  text-overflow: ellipsis;
	}
	/* ê¸°ì‚¬ ë‚´ìš© */
	.category-label {
		color: #1e90ff;
		font-weight: bold;
		margin-bottom: 10px;
		font-size: 14px;
	}

	.article-title {
		font-size: 24px;
		font-weight: bold;
		line-height: 1.4;
		margin-bottom: 10px;
	}

	.article-info {
		font-size: 13px;
		color: gray;
		margin-bottom: 15px;
	}

	.article-interact {
		font-size: 15px;
		margin-bottom: 20px;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.article-body img {
		width: 100%;
		max-width: 700px;
		min-width: 700px;
		/* ğŸ‘ˆ ì´ ì¤„ì´ í¬ì¸íŠ¸ */
		height: auto;
		display: block;
		margin: 10px auto;
	}

	.article-body {
		font-size: 18px;
	}

	.reporter-card {
		width: 700px;
		background: #f8f9fa;
		border-radius: 12px;
		padding: 16px;
		font-family: 'Arial', sans-serif;
		box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
		margin: 0 auto;
		margin-top: 50px;
	}

	.reporter-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
	}

	.profile-img {
		width: 48px;
		height: 48px;
		border-radius: 50%;
		margin-right: 10px;
	}

	.reporter-info {
		flex: 1;
	}

	.reporter-name {
		font-weight: bold;
		font-size: 15px;
	}

	.reporter-stats {
		font-size: 13px;
		color: #666;
	}

	.subscribe-btn {
		background-color: #f1f3f5;
		border: none;
		padding: 6px 12px;
		border-radius: 20px;
		font-size: 13px;
		cursor: pointer;
	}

	.reporter-board {
		margin-top: 10px;
		font-size: 14px;
		color: #222;
		line-height: 1.4;
		cursor: pointer;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
		display: block;
		width: 100%;
	}


	.media-logo {
		width: 20px;
		margin-right: 6px;
	}

	.media-text {
		font-size: 13px;
		color: #007BFF;
		text-decoration: none;
	}

	.reporter-in {
		font-size: 13px;
		font-weight: 400;
	}

	.reaction-hr {
		margin-top: 40px;
		margin-bottom: 30px;
	}
	a {
	  text-decoration: none;
	  color: inherit; /* ê¸°ë³¸ ê¸€ììƒ‰ë„ ìƒì†ë°›ê²Œ */
	}
</style>

<div class="site-header">
	<div class="container">
		<div class="logo"><a href="/user/main"><img src="/images/logo.png"></a></div>

		<div class="top-bar">
			<div class="date" th:text="${#dates.format(#dates.createNow(), 'yyyy.MM.dd')}"></div>
			<div class="user-menu">
				    <a th:href="${session.role == 'admin'} ? @{/report/list} : @{/report/write}">ê¸°ì‚¬ì œë³´</a>
				  <span th:if="${session.sid == null}">
				      <a th:href="@{/user/login}">ë¡œê·¸ì¸</a>
				      <a th:href="@{/user/insert}">íšŒì›ê°€ì…</a>
				  </span>
				  <span th:if="${session.sid != null and session.role == 'admin'}">
						  <a th:href="@{/user/logout}">ë¡œê·¸ì•„ì›ƒ</a>
						  <a th:href="@{/admin/adminPage}">ê´€ë¦¬ì í˜ì´ì§€</a>
				  </span>

				  <span th:if="${session.sid != null and session.role == 'user'}">
						  <a th:href="@{/user/myPage}">ë§ˆì´í˜ì´ì§€</a>
				  	      <a th:href="@{/user/logout}">ë¡œê·¸ì•„ì›ƒ</a>
				  </span>

				  <span th:if="${session.sid != null and session.role == 'reporter'}">
						  <a th:href="@{/user/myPage}">ê¸°ìí˜ì´ì§€</a>
					  	  <a th:href="@{/user/logout}">ë¡œê·¸ì•„ì›ƒ</a>
				  </span>
				</div>
				</div>

				<nav class="main-nav">
				  <ul>
				    <li><a href="/news/home">ë‰´ìŠ¤</a></li>
				    <li><a href="/sports/main">ìŠ¤í¬ì¸ </a></li>
				    <li><a href="/enter/main">ì—”í„°</a></li>
			</ul>
			<div class="search">
				<input type="text" placeholder="ê²€ìƒ‰" />
			</div>
		</nav>

		<nav class="sub-nav">
			<ul>

				<li><a href="/sports/main">ë©”ì¸</a></li>
				<li><a href="/sports/football">ì¶•êµ¬</a></li>
				<li><a href="/sports/baseball">ì•¼êµ¬</a></li>
				<li><a href="/sports/basketball">ë†êµ¬</a></li>
				<li><a href="/sports/volleyball">ë°°êµ¬</a></li>
			</ul>
		</nav>
	</div>
</div>

<div class="container_body">
	<!-- ì¢Œì¸¡ ë©”ì¸ ê¸°ì‚¬ ì˜ì—­ -->
	<div class="main-content">
		<div class="category-label">ìŠ¤í¬ì¸ ë”í™íŠ¸</div>

		<h2 class="article-title">
			[[${dto.title}]]
		</h2>

		<div class="article-info">
			[[${#temporals.format(dto.reg,'yyyy.MM.dd HH:mm')}]] | [[${repo.name}]] ê¸°ì
		</div>

		<div class="article-interact">
			<span class="likes">ë°˜ì‘ [[${allReaction}]]</span>
			<span class="icons">ğŸ” ğŸ“</span>
		</div>

		<div class="article-body" th:utext="${dto.content}"></div>


		<div class="reporter-card">
			<div class="reporter-header">
				<img th:src="${repo.profile_img}" alt="ê¸°ì ì´ë¯¸ì§€" class="profile-img">
				<div class="reporter-info">
					<div class="reporter-name">[[${repo.name}]] ê¸°ì</div>
					<div class="reporter-stats">[[${repo.category}]]ë‰´ìŠ¤ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.</div>
				</div>
			</div>
			<div th:each="spList:${spList}">
				<div class="reporter-board" ><a th:text="${spList.title}" th:href="@{|/sports/content/${spList.num}|}"></a></div>
			</div>

		</div>
		<hr class="reaction-hr">
		<div class="reaction-buttons">
			<button class="reaction-button" data-type="like">
				<img src="/images/like.png" alt="ì¢‹ì•„ìš”" />
				<span>ì¢‹ì•„ìš”</span>
				<strong th:text="${count['like']} ?: 0"
					th:style="${userReaction == 'like'} ? 'color: #ff4d4d; font-weight: bold;' : ''">>
				</strong>
				<button class="reaction-button" data-type="sad">
					<img src="/images/sad.png" alt="ìŠ¬í¼ìš”" />
					<span>ìŠ¬í¼ìš”</span>
					<strong th:text="${count['sad']} ?: 0"
						th:style="${userReaction == 'sad'} ? 'color: #ff4d4d; font-weight: bold;' : ''"></strong>
				</button>
				<button class="reaction-button" data-type="angry">
					<img src="/images/angry.png" alt="í™”ë‚˜ìš”" />
					<span>í™”ë‚˜ìš”</span>
					<strong th:text="${count['angry']} ?: 0"
						th:style="${userReaction == 'angry'} ? 'color: #ff4d4d; font-weight: bold;' : ''"></strong>
				</button>
				<button class="reaction-button" data-type="surprise">
					<img src="/images/surprise.png" alt="ë†€ëì–´ìš”" />
					<span>ë†€ëì–´ìš”</span>
					<strong th:text="${count['surprise']} ?: 0"
						th:style="${userReaction == 'surprise'} ? 'color: #ff4d4d; font-weight: bold;' : ''"></strong>
				</button>
				<button class="reaction-button" data-type="followup">
					<img src="/images/followup.png" alt="í›„ì†ê¸°ì‚¬ ì›í•´ìš”" />
					<span>í›„ì†ê¸°ì‚¬ ì›í•´ìš”</span>
					<strong th:text="${count['followup']} ?: 0"
						th:style="${userReaction == 'followup'} ? 'color: #ff4d4d; font-weight: bold;' : ''"></strong>
				</button>
		</div>
	</div>

	<!-- ìš°ì¸¡ ì‚¬ì´ë“œë°” -->
	<div class="sidebar">
		<!-- ì¶”ì²œ ê¸°ì‚¬ ë“±ì€ ì¶”í›„ ì‚½ì… ê°€ëŠ¥ -->
		ë§ì´ ë³¸ ìŠ¤í¬ì¸  ê¸°ì‚¬
		<hr>
		<div th:each="list,i : ${list}">
			<a class="ellipsis" th:text="${i.count + '. ' + list.title}" th:href="@{|/sports/content/${list.num}|}"></a>
		</div>

	</div>
</div>
<footer class="footer">
  <div class="footer-logo">THE FACT</div>
  <div class="footer-info">
    (ì£¼)ë”íŒ©íŠ¸ | ë“±ë¡ë²ˆí˜¸: 0000 | ë“±ë¡Â·ë°œí–‰ì¼ì: 2025.07.22 | ì œí˜¸: ë”íŒ©íŠ¸ | ë°œí–‰ì¸: ë”í™íŠ¸ | í¸ì§‘ì¸: ë”í™íŠ¸ | ì „í™”ë²ˆí˜¸: 02-6020-0055<br>
    ì£¼ì†Œ: ì„œìš¸ì‹œ ê´€ì•…êµ¬ ë‚¨ë¶€ìˆœí™˜ë¡œ 1820 (ì—ê·¸ì˜ë¡œìš° 14ì¸µ) | í•œêµ­ê¸°ìí˜‘íšŒ, í•œêµ­ì‚¬ì§„ê¸°ìí˜‘íšŒ, í•œêµ­ì¸í„°ë„·ì‹ ë¬¸í˜‘íšŒ íšŒì›ì‚¬<br>
    Copyright â“’ ë”íŒ©íŠ¸(tf.co.kr) THE FACTì˜ ëª¨ë“  ì½˜í…ì¸ ëŠ” ì§€ì  ì¬ì‚°ê¶Œë²•ì˜ ë³´í˜¸ë¥¼ ë°›ëŠ” ë°”, ë¬´ë‹¨ ë³µì‚¬, ì „ì¬, ë°°í¬ ë“±ì€ ë²•ì  ì œì¬ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </div>
</footer>

<script>
	$(document).ready(function () {
		// í˜„ì¬ ì‚¬ìš©ìê°€ ì„ íƒí•œ ë¦¬ì•¡ì…˜ íƒ€ì…
		let currentReaction = '[[${reactionType}]]';
		if (!currentReaction || currentReaction === 'null' || currentReaction.trim() === '') {
			currentReaction = null;
		}

		const boardNum = "[[${dto.num}]]";
		const id = "[[${session.sid}]]"


		$('.reaction-button').click(function () {
			const clickedType = $(this).data('type');

			if (!id || id === 'null') {
				if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
					window.location.href = '/user/login';
				}
				return;
			}

			// ë¦¬ì•¡ì…˜ ì·¨ì†Œ (ê°™ì€ ê±° ë‹¤ì‹œ ëˆ„ë¦„ or ë³€ê²½)
			const deleteOld = currentReaction !== null
				? $.ajax({
					url: '/sports/reaction',
					method: 'delete',
					data: {
						reactionType: currentReaction,
						boardNum: boardNum,
						id: id
					}
				})
				: Promise.resolve(); // ì—†ìœ¼ë©´ ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„

			deleteOld.then(() => {
				// ê°™ì€ ê±¸ ëˆŒë €ìœ¼ë©´ ì‚­ì œë§Œ í•˜ê³  ì¶”ê°€ëŠ” ì•ˆ í•¨
				if (currentReaction === clickedType) {
					currentReaction = null;
					location.reload();
					return;
				}

				// ìƒˆ ë¦¬ì•¡ì…˜ ì¶”ê°€
				$.ajax({
					url: '/sports/reaction',
					method: 'POST',
					data: {
						reactionType: clickedType,
						boardNum: boardNum,
						id: id
					},
					success: function () {
						currentReaction = clickedType;
						location.reload();
					},
					error: function () {
						alert("ë¦¬ì•¡ì…˜ ë“±ë¡ ì‹¤íŒ¨");
					}
				});
			});
		});
	});




</script>