<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" th:href="@{/css/main.css}">
<link rel="stylesheet" th:href="@{/css/reaction.css}">
<style>
	/* ì „ì²´ ì»¨í…Œì´ë„ˆ */
	.container_body {
	  display: flex;
	  flex-direction: row;
	  max-width: 1100px;
	  margin: 40px auto;
	  gap: 30px;
	  font-family: 'Noto Sans KR', sans-serif;
	}

	/* ë©”ì¸ ê¸°ì‚¬ ë°•ìŠ¤ */
	.main-content {
	  flex: 1;
	  background-color: #fff;
	  padding: 25px;
	  border: 1px solid #ddd;
	  border-radius: 10px;
	  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
	}

	/* ì‚¬ì´ë“œë°” ë°•ìŠ¤ */
	.sidebar {
	  width: 200px;
	  background-color: #f9f9f9;
	  border: 1px solid #ddd;
	  border-radius: 10px;
	  min-height: 800px;
	  padding: 15px;
	  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
	}

	/* ê¸°ì‚¬ ë‚´ìš© */
	.category-label {
	  color: #1e90ff;
	  font-weight: bold;
	  margin-bottom: 10px;
	  font-size: 14px;
	}

	.article-title {
	  font-size: 24px;
	  font-weight: bold;
	  line-height: 1.4;
	  margin-bottom: 10px;
	}

	.article-info {
	  font-size: 13px;
	  color: gray;
	  margin-bottom: 15px;
	}

	.article-interact {
	  font-size: 15px;
	  margin-bottom: 20px;
	  display: flex;
	  justify-content: space-between;
	  align-items: center;
	}
	.article-body img {
	  width: 100%;
	  max-width: 700px;
	  min-width: 700px;  /* ğŸ‘ˆ ì´ ì¤„ì´ í¬ì¸íŠ¸ */
	  height: auto;
	  display: block;
	  margin: 10px auto;
	}
	.article-body {
		font-size:18px;
	}
	.reporter-card {
	  width: 700px;
	  background: #f8f9fa;
	  border-radius: 12px;
	  padding: 16px;
	  font-family: 'Arial', sans-serif;
	  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
	  margin: 0 auto;  
	  margin-top:50px;
	}

	.reporter-header {
	  display: flex;
	  align-items: center;
	  justify-content: space-between;
	}

	.profile-img {
	  width: 48px;
	  height: 48px;
	  border-radius: 50%;
	  margin-right: 10px;
	}

	.reporter-info {
	  flex: 1;
	}

	.reporter-name {
	  font-weight: bold;
	  font-size: 15px;
	}

	.reporter-stats {
	  font-size: 13px;
	  color: #666;
	}

	.subscribe-btn {
	  background-color: #f1f3f5;
	  border: none;
	  padding: 6px 12px;
	  border-radius: 20px;
	  font-size: 13px;
	  cursor: pointer;
	}

	.reporter-board {
	  margin-top: 10px;
	  font-size: 14px;
	  color: #222;
	  line-height: 1.4;
	  cursor: pointer;
	}


	.media-logo {
	  width: 20px;
	  margin-right: 6px;
	}

	.media-text {
	  font-size: 13px;
	  color: #007BFF;
	  text-decoration: none;
	}
	.reporter-in{
		font-size:13px;
		font-weight: 400;
	}
	.reaction-hr{
		margin-top:40px;
		margin-bottom:30px;
	}
</style>

<div class="site-header">
	<div class="container">
  <div class="logo">ë¡œê³ </div>

  <div class="top-bar">
    <div class="date">2025.07.03</div>
    <div class="user-menu">
      <a th:href="${session.role == 'admin'} ? @{/report/list} : @{/report/write}">ê¸°ì‚¬ì œë³´</a>
	  <span th:if="${session.sid == null}">
	      <a th:href="@{/user/login}">ë¡œê·¸ì¸</a>
	      <a th:href="@{/user/insert}">íšŒì›ê°€ì…</a>
	  </span>
	  <span th:if="${session.sid != null and session.role == 'admin'}">
			  <a th:href="@{/user/logout}">ë¡œê·¸ì•„ì›ƒ</a>
			  <a th:href="@{/admin/adminPage}">ê´€ë¦¬ìí˜ì´ì§€</a>
	  </span>
	  <span th:if="${session.sid != null and session.role != 'admin'}">
	  	      <a th:href="@{/user/logout}">ë¡œê·¸ì•„ì›ƒ</a>
	  <span th:if="${session.sid != null}">
			  <a th:href="@{/user/myPage}">ë§ˆì´í˜ì´ì§€</a>
	  	      <a th:href="@{/user/logout}">ë¡œê·¸ì•„ì›ƒ</a>
	  </span>
	</div>
  </div>

  <nav class="main-nav">
    <ul>
      <li><a href="#">ë‰´ìŠ¤</a></li>
      <li><a th:href="@{/sports/main}">ìŠ¤í¬ì¸ </a></li>
      <li><a href="#">ì—”í„°</a></li>
    </ul>
    <div class="search">
      <input type="text" placeholder="ê²€ìƒ‰" />
    </div>
  </nav>

  <nav class="sub-nav">
    <ul>

		<li><a href="/sports/main">ì¢…í•©</a></li>
		<li><a href="/sports/football">ì¶•êµ¬</a></li>
		<li><a href="/sports/baseball">ì•¼êµ¬</a></li>
		<li><a href="/sports/basketball">ë†êµ¬</a></li>
		<li><a href="/sports/volleyball">ë°°êµ¬</a></li>
    </ul>
  </nav>
</div>
</div>

<div class="container_body">
  <!-- ì¢Œì¸¡ ë©”ì¸ ê¸°ì‚¬ ì˜ì—­ -->
  <div class="main-content">
    <div class="category-label">ìŠ¤í¬ì¸ ì¡°ì„ </div>

    <h2 class="article-title">
      [[${dto.title}]]
    </h2>

    <div class="article-info">
      [[${#temporals.format(dto.reg,'yyyy.MM.dd HH:mm')}]] | [[${repo.name}]] ê¸°ì
    </div>

    <div class="article-interact">
      <span class="likes">â¤ï¸ 28</span>
      <span class="icons">ğŸ” ğŸ“</span>
    </div>

    <div class="article-body" th:utext="${dto.content}"></div>
	
	
	<div class="reporter-card">
	  <div class="reporter-header">
	    <img th:src="${repo.profile_img}" alt="ê¸°ì ì´ë¯¸ì§€" class="profile-img">
	    <div class="reporter-info">
	      <div class="reporter-name">[[${repo.name}]] ê¸°ì<span class="reporter-in">  êµ¬ë… ?</span></div>
	      <div class="reporter-stats">[[${repo.category}]]ë‰´ìŠ¤ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.</div>
	    </div>
	    <button class="subscribe-btn">+ êµ¬ë…</button>
	  </div>

	  <div class="reporter-board">Kë¦¬ê·¸ MVP-ë“ì ì™• ë§ì»¹, 6ë…„ ë§Œì˜ ë³µê·€â€¦ ìš¸ì‚° HDì™€ ê³„ì•½ "í•œêµ­ ë³µê·€ ë‹¹ì—°í–ˆë‹¤"[ê³µì‹ë°œí‘œ]</div>
	  <div class="reporter-board">"ëˆˆë¶€ì‹  ì—…ì  ë‚¨ê¸´ ì¡°íƒ€" ìš¸ë²„í–„íŠ¼, ëª…ì˜ˆì˜ ì „ë‹¹ í—Œì•¡ ê²°ì •â€¦ "ë§ì¥ì¼ì¹˜ë¡œ ì¦‰ê° ê²°ì •"</div>

	</div>
	<hr class="reaction-hr">
	<div class="reaction-buttons">
	  <button class="reaction-button" data-type="like">
	    <img src="/images/emoji_like.png" alt="ì¢‹ì•„ìš”" />
	     <strong th:text="${count['like']} ?: 0"></strong>
	  </button>
	  <button class="reaction-button" data-type="sad">
	    <img src="/images/emoji_sad.png" alt="ìŠ¬í¼ìš”" />
	    <span>ìŠ¬í¼ìš”</span>
	    
	  </button>
	  <button class="reaction-button" data-type="angry">
	    <img src="/images/emoji_angry.png" alt="í™”ë‚˜ìš”" />
	    <span>í™”ë‚˜ìš”</span>
	  
	  </button>
	  <button class="reaction-button" data-type="surprise">
	    <img src="/images/emoji_fan.png" alt="ë†€ëì–´ìš”" />
	    <span>íŒ¬ì´ì—ìš”</span>
	  
	  </button>
	  <button class="reaction-button" data-type="followup">
	    <img src="/images/emoji_followup.png" alt="í›„ì†ê¸°ì‚¬ ì›í•´ìš”" />
	    <span>í›„ì†ê¸°ì‚¬ ì›í•´ìš”</span>
	
	  </button>
	</div>
  </div>

  <!-- ìš°ì¸¡ ì‚¬ì´ë“œë°” -->
  <div class="sidebar">
    <!-- ì¶”ì²œ ê¸°ì‚¬ ë“±ì€ ì¶”í›„ ì‚½ì… ê°€ëŠ¥ -->
  </div>
</div>

<script>
	$(document).ready(function(){
		// í˜„ì¬ ì‚¬ìš©ìê°€ ì„ íƒí•œ ë¦¬ì•¡ì…˜ íƒ€ì…
 		let currentReaction = '[[${reactionType}]]' || null;
		const boardNum = "[[${dto.boardNum}]]";
		const id = "[[${session.sid}]]"
		$('.reaction-button').click(function(){
			// í´ë¦­í•œ ë¦¬ì•¡ì…˜ íƒ€ì…
			const clickedType = $(this).data('type');
			
			if(currentReaction === clickedType){
				// ê°™ì€ ë²„íŠ¼ í´ë¦­ì‹œ ì·¨ì†Œ ìš”ì²­
				$.ajax({
					url:'/sports/reaction',
					method:'delete',
					data:{
						reactionType:clickedType,
						boardNum:boardNum,
						id:id
					},
					success:function(){
						currentReaction=null;
						updateUI(null);
					},
					error:function(){
						alert("ì·¨ì†Œì‹¤íŒ¨");
					}
				});
			}else{
				    // 1. ê¸°ì¡´ ë°˜ì‘ì´ ìˆë‹¤ë©´ ë¨¼ì € ì‚­ì œ
				    const deleteOld = currentReaction !== null
				    ?  $.ajax({
				          url: '/sports/reaction',
				          method: 'delete',
				          contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
				          data: {
				            reactionType: currentReaction,
				            boardNum: boardNum,
				            id: id
				          }
				        })
				     : Promise.resolve(); // ì—†ìœ¼ë©´ ì¦‰ì‹œ ì„±ê³µ ì²˜ë¦¬

				    // 2. ì‚­ì œ í›„ ìƒˆë¡œìš´ ë¦¬ì•¡ì…˜ ë“±ë¡
				    deleteOld.then(() => {
				      $.ajax({
				        url: '/sports/reaction',
				        method: 'POST',
				        contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
				        data: {
				          reactionType: clickedType,
				          boardNum: boardNum,
				          id: id
				        },
				        success: function () {
				          currentReaction = clickedType;
				          updateUI(clickedType);
						  
				        },
				        error: function () {
				          alert("ë¦¬ì•¡ì…˜ ë“±ë¡ ì‹¤íŒ¨");
				        }
				      });
				    });
				  }
				});
		
		function updateUI(select){
			$('.reaction-button').each(function(){
				const type=$(this).data('type');
				if(type===select){
					$(this).addClass('select');
				}else{
					$(this).removeClass('select');
				}
			});
		}
	});
	

</script>