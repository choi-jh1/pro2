<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ex.repository.BoardMapper">
	<!-- nvl(컬럼명, 값)-->
	<select id="maxNum" resultType="int">
		select NVL(max(num), 0) from board
	</select>
	
	<!-- 답글일 때 기존 답글을 아래로 밀고(re_step+1) 새 답글을 위로 정렬하기 위해 값 수정-->
	<update id="reStepUp">
		update board set re_step=re_step+1 where ref=#{ref} and re_step > #{re_step}
	</update>
	
	<insert id="boardInsert">
		insert into board values( board_seq.nextval, #{writer}, #{title}, #{content}, #{pw}, 0, #{ref}, #{re_level}, #{re_step}, sysdate)
	</insert>
<!--
	<![CDATA[SQL문 작성]]>
	특수문자 <, > 가 태그로 인식되지않도록 해준다
-->	
	
	<select id="boardList" resultType="com.ex.data.BoardDTO">
		<![CDATA[
		select * from ( select b.*, rownum r from 
            ( select * from board order by ref desc, re_step asc ) b )
            where r >= #{start} and r <= #{end} 
        ]]>
	</select>
	
	<!-- 글 개수 -->
	<select id="boardCount" resultType="int" >
		select count(*) from board
	</select>
	
	<!-- 글 내용-->
	<select id="content" resultType="com.ex.data.BoardDTO">
		select * from board where num=#{num}	
	</select>
</mapper>
















